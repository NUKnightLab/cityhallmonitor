{% extends "base.html" %}

{% block content %}

<div id="manage-alert" data-alert class="alert-box alert" style="display: none;">
  <span></span>
  <a href="#" class="close">&times;</a>  
</div>

<div id="manage-alert-success" data-alert class="alert-box info" style="display: none;">
    <span>Your email has been sent!</span>
    <a href="#" class="close">&times;</a>  
</div>

<div class="row">
    <div class="small-8 small-offset-2 columns">
        <h2>Manage subscriptions</h2>
        <p>Enter your email address below, and we'll send you a link to manage your subscriptions.</p>
        <form>
            <div class="row collapse">
                <div class="small-10 columns">
                    <input type="text" id="manage-subs" placeholder="Email address you subscribed with">
                </div>
                <div class="small-2 columns end">
                    <input type="submit" value="Submit" id="manage-submit" class="button tiny postfix">
                </div>
            </div>
        </form>
    </div>
</div>

{% endblock content %}

{% block extra_scripts %}

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
<script type="text/javascript" src="//cdn.knightlab.com/libs/purpleline/latest/js/foundation.alert.js"></script>
<script type="text/javascript">

function manage_alert(error, detail) {
    $('#manage-alert > span').html(error + (detail ? ' ['+detail+']' : ''));
    $('#manage-alert').show();
}

$(function() {
    $(document).foundation();

    $('#manage-submit').click(function(event) {  
        $('#manage-alert, #manage-alert-success').hide();
         
        var email = $('#manage-subs').val().trim();       
        if(email) {
            $('#manage-submit').prop('disabled', true);
            
            $.ajax({
                url: '{% url "send_notifications_link" %}',
                type: 'GET',
                data: {
                    email: email
                },
                cache: false,
                dataType: 'json',
                timeout: 20000,
                error: function(xhr, status, err) {
                    manage_alert('Error sending link', err);
                },
                success: function(data) {
                    if(data.error) {
                        manage_alert('Error sending link', data.error);
                    } else {               
                        $('#manage-alert-success').show();
                    }
                },
                complete: function() {
                    $('#manage-submit').prop('disabled', false);                
                }
            });    
        }    
    });
});

</script>

{% endblock extra_scripts %}